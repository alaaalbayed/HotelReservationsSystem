@model IEnumerable<Domain.DTO_s.LookUpProperty>

@using Microsoft.AspNetCore.Mvc.Localization;
@using System.Globalization;

@inject IViewLocalizer localizer

@{
    Layout = "_Layout";
    ViewData["Title"] = "Types Options";
    ViewData["ActivePage"] = "TypesOptions";
    var check = CultureInfo.CurrentCulture.Name;
}

<div class="wrapper">
    <partial name="_Slide" />
    <div class="main">
        <partial name="_Navbar" />
        <main class="content">
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                    </div>
                </div>
            </div>
            @if (Model.Any())
            {
                <div class="row row-cards">
                    <div class="col-lg-12">
                        <div class="card p-3">
                            <div class="table-responsive">
                                <table class="table table-hover table-bordered text-center">
                                    <thead>
                                        @if (check == "en-US")
                                        {
                                            <tr>
                                                <th>
                                                    @localizer["Type"]
                                                </th>
                                                <th>
                                                    Options
                                                </th>
                                                <th>
                                                    @localizer["Details"]
                                                </th>
                                                <th>
                                                    @localizer["Events"]
                                                </th>
                                            </tr>
                                        }
                                        else
                                        {
                                            <tr>
                                                <th>
                                                    @localizer["Events"]
                                                </th>
                                                <th>
                                                    @localizer["Details"]
                                                </th>
                                                <th>
                                                    الخيارات
                                                </th>
                                                <th>
                                                    @localizer["Type"]
                                                </th>
                                            </tr>
                                        }
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model)
                                        {
                                            if (check == "en-US")
                                            {
                                                <tr>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.LookUpType.NameEn)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.NameEn)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.Details)
                                                    </td>
                                                    <td class="col-5">

                                                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-success btn-icon btn-sm" aria-label="Button">
                                                            @localizer["Edit"]
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-edit" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                                                <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"></path>
                                                                <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"></path>
                                                                <path d="M16 5l3 3"></path>
                                                            </svg>
                                                        </a> |
                                                        <a asp-action="Info" asp-route-id="@item.Id" class="btn btn-warning btn-icon btn-sm" aria-label="Button">
                                                            @localizer["Info"]
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-id" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                                                <path d="M3 4m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v10a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z"></path>
                                                                <path d="M9 10m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"></path>
                                                                <path d="M15 8l2 0"></path>
                                                                <path d="M15 12l2 0"></path>
                                                                <path d="M7 16l10 0"></path>
                                                            </svg>
                                                        </a> |
                                                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-icon btn-sm deleteButton" aria-label="Button" data-bs-toggle="modal" data-bs-target="#exampleModal" data-delete-url="@Url.Action("Delete", new { id = item.Id })">
                                                            @localizer["Delete"]
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                                                <path d="M4 7l16 0"></path>
                                                                <path d="M10 11l0 6"></path>
                                                                <path d="M14 11l0 6"></path>
                                                                <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                                                                <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                                                            </svg>
                                                        </a>
                                                    </td>
                                                </tr>
                                            }
                                            else
                                            {
                                                <tr>
                                                    <td class="col-5">
                                                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-icon btn-sm deleteButton" aria-label="Button" data-bs-toggle="modal" data-bs-target="#exampleModal" data-delete-url="@Url.Action("Delete", new { id = item.Id })">
                                                            @localizer["Delete"]
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                                                <path d="M4 7l16 0"></path>
                                                                <path d="M10 11l0 6"></path>
                                                                <path d="M14 11l0 6"></path>
                                                                <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                                                                <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                                                            </svg>
                                                        </a> |

                                                        <a asp-action="Info" asp-route-id="@item.Id" class="btn btn-warning btn-icon btn-sm" aria-label="Button">
                                                            @localizer["Info"]
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-id" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                                                <path d="M3 4m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v10a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z"></path>
                                                                <path d="M9 10m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"></path>
                                                                <path d="M15 8l2 0"></path>
                                                                <path d="M15 12l2 0"></path>
                                                                <path d="M7 16l10 0"></path>
                                                            </svg>
                                                        </a> |
                                                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-success btn-icon btn-sm" aria-label="Button">
                                                            @localizer["Edit"]
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-edit" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                                                <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"></path>
                                                                <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"></path>
                                                                <path d="M16 5l3 3"></path>
                                                            </svg>
                                                        </a>
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.Details)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.NameAr)
                                                    </td>
                                                    <td>
                                                        @Html.DisplayFor(modelItem => item.LookUpType.NameAr)
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                                <p class="text-center me-4">
                                    <a asp-action="Create" class="btn btn-primary position-relative start-50 mt-3 me-6">@localizer["Create"]</a>
                                </p>
                            </div>
                        </div>

                    </div>

                </div>
            }
            else
            {
                <div class="row justify-content-md-center">
                    <div class="col-lg-8 ms-5">
                        <div class="card p-7 m-5">
                            <p class="text-center fs-1">There is No Room Type</p>
                            <p>
                                <a asp-action="Create" class="btn btn-primary mt-5" style="margin-left:12rem;">Create New</a>
                            </p>
                        </div>
                    </div>
                </div>
            }
        </main>
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">@localizer["DeleteConfirmation"]</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        @localizer["AreYouSureDelete"]
                    </div>

                    <div class="modal-footer">
                        @if (check == "en-US")
                        {
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@localizer["Close"]</button>
                            <button type="button" class="btn btn-primary" id="deleteButton">@localizer["Yes"]</button>
                        }
                        else
                        {
                            <button type="button" class="btn btn-primary" id="deleteButton">@localizer["Yes"]</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@localizer["Close"]</button>
                        }
                    </div>
                </div>
            </div>
        </div>
        <partial name="_Footer" />
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        function showDeleteModal(deleteUrl) {
            console.log("showDeleteModal called.");
            var deleteButton = document.getElementById("deleteButton");
            deleteButton.dataset.url = deleteUrl;

            deleteButton.addEventListener("click", function () {
                var deleteUrl = this.dataset.url;
                var headers = new Headers();
                headers.append('RequestVerificationToken', document.querySelector('input[name="__RequestVerificationToken"]').value); // Include the CSRF token

                fetch(deleteUrl, {
                    method: 'DELETE',
                    credentials: 'include',
                    headers: headers
                })
                    .then(response => {
                        if (response.ok) {
                            location.reload();
                        } else {
                            console.error("Failed to delete room type.");
                        }
                    })
                    .catch(error => {
                        console.error("Error occurred while deleting room type:", error);
                    });
            });
        }

        var deleteButtons = document.getElementsByClassName("deleteButton");
        for (var i = 0; i < deleteButtons.length; i++) {
            deleteButtons[i].addEventListener("click", function () {
                var deleteUrl = this.dataset.deleteUrl;
                showDeleteModal(deleteUrl);
            });
        }
    });
</script>
